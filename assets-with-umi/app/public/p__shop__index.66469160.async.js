(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[7],{BHDh:function(e,t,a){"use strict";var l=a("mPyJ"),n=a("VPuB");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("0QPP");var d=n(a("jwx+"));a("kB5y");var u=n(a("k6sw"));a("Rv6O");var f=n(a("Refp")),r=n(a("3Yg9"));a("bFjL");var s=n(a("0akA"));a("ySvj");var m=n(a("2yvn")),i=n(a("xqoM"));a("cpya");var o=n(a("KMvT")),c=l(a("4G06")),p=n(a("jQdL")),E=n(a("eQPK"));class _ extends c.Component{constructor(){super(...arguments),this.state={index:0,menuIndex:0,menu:[],info:{}},this.itemOffset={},this.getImage=(e=>{if(!e)return"";var t=e[0]+"/"+e.substr(1,2)+"/"+e.substr(3),a="jpeg";return t.indexOf("png")>-1&&(a="png"),`http://fuss10.elemecdn.com/${t}.${a}`}),this.loadMenu=(e=>{fetch(`/restapi/shopping/v2/menu?restaurant_id=${e}`).then(e=>{200===e.status&&e.json().then(e=>{this.setState({menu:e})})}).catch(e=>{console.warn(e)})}),this.loadInfo=(e=>{var t=this.props.location.query,a=t.longitude,l=t.latitude;fetch(`/restapi/shopping/restaurant/${e}?extras[]=activities&extras[]=albums&extras[]=license&extras[]=identification&extras[]=qualification&terminal=h5&latitude=${l}&longitude=${a}`).then(e=>{200===e.status&&e.json().then(e=>{this.setState({info:e})})}).catch(e=>{console.warn(e)})}),this.renderTab=(e=>{return c.default.createElement("div",{className:E.default.menuItem},e.name)}),this.renderFood=((e,t)=>{var a=e.id||e.virtual_food_id;return"type"===e._type?c.default.createElement("div",{key:a+`_${t}`,id:a,ref:e=>{e&&(this.itemOffset[a]={top:e.offsetTop,id:a})}},c.default.createElement(o.default.Item,null,c.default.createElement("div",{className:E.default.foodType},e.name," ",c.default.createElement("span",{className:E.default.desc},e.description)))):"food"===e._type?c.default.createElement("div",{key:a+`_${t}`,id:a},c.default.createElement(o.default.Item,null,c.default.createElement("div",{className:E.default.food},c.default.createElement("div",{className:E.default.image},c.default.createElement("img",{src:this.getImage(e.image_path),alt:e.name})),c.default.createElement("div",{className:E.default.info},c.default.createElement("div",null,e.name),c.default.createElement("div",{className:E.default.subInfo},"\u6708\u552e",e.month_sales,"\u4efd \u597d\u8bc4\u7387",e.satisfy_rate,"%"))))):void 0}),this.throttle=!1,this.offset=0}componentWillMount(){window.scrollTo(0,0);var e=this.props.location.query.id;this.loadMenu(e),this.loadInfo(e)}render(){var e=this.state,t=e.index,a=e.info,l=e.menu,n=e.menuIndex,_=[];return l.forEach(e=>{_.push((0,i.default)({_type:"type"},e,{foods:null})),(e.foods||[]).forEach(e=>{_.push((0,i.default)({_type:"food"},e))})}),c.default.createElement("div",{className:E.default.discover},c.default.createElement(s.default,{onLeftClick:()=>p.default.goBack(),mode:"dark",icon:c.default.createElement(m.default,{type:"left"})}),c.default.createElement("div",{className:E.default.info},c.default.createElement("div",{className:E.default.logo},c.default.createElement("img",{src:this.getImage(a.image_path),alt:a.name})),c.default.createElement("div",{className:E.default.title},a.is_premium?c.default.createElement("span",{className:E.default.premium},"\u54c1\u724c"):null,a.name)),c.default.createElement(f.default,{tabs:[{title:"\u70b9\u9910"},{title:"\u8bc4\u4ef7"},{title:"\u5546\u5bb6"}],useOnPan:!1,swipeable:!1,page:t,onChange:(e,t)=>{this.setState({index:t})}},c.default.createElement("div",{className:E.default.menu},c.default.createElement("div",null,c.default.createElement(f.default,{tabs:l,tabBarPosition:"left",tabDirection:"vertical",usePaged:!1,swipeable:!1,page:n,onChange:(e,t)=>{this.setState({menuIndex:t},()=>{document.getElementById("foodList").scrollTo(0,document.getElementById(e.id).offsetTop)})},renderTabBar:e=>c.default.createElement(f.default.DefaultTabBar,(0,r.default)({},e,{renderTab:this.renderTab,page:10}))})),c.default.createElement("div",{id:"foodList",className:E.default.list,onScroll:e=>{this.offset=e.nativeEvent.target.scrollTop+200,this.throttle||(this.throttle=!0,setTimeout(()=>{this.throttle=!1;var e=Object.keys(this.itemOffset).map(e=>this.itemOffset[e]).sort((e,t)=>e.top-t.top),t=e.findIndex(e=>e.top>this.offset);this.setState({menuIndex:t-1})},300))}},c.default.createElement(o.default,null,_.map((e,t)=>this.renderFood(e,t))))),c.default.createElement("div",{className:E.default.overview},c.default.createElement(o.default,null,c.default.createElement(o.default.Item,null,"\u8bc4\u4ef7"),c.default.createElement(o.default.Item,null,"\u8bc4\u4ef7"),c.default.createElement(o.default.Item,null,"\u8bc4\u4ef7"),c.default.createElement(o.default.Item,null,"\u8bc4\u4ef7"),c.default.createElement(o.default.Item,null,"\u8bc4\u4ef7"),c.default.createElement(o.default.Item,null,"\u8bc4\u4ef7"),c.default.createElement(o.default.Item,null,"\u8bc4\u4ef7"),c.default.createElement(o.default.Item,null,"\u8bc4\u4ef7"),c.default.createElement(o.default.Item,null,"\u8bc4\u4ef7"),c.default.createElement(o.default.Item,null,"\u8bc4\u4ef7"),c.default.createElement(o.default.Item,null,"\u8bc4\u4ef7"),c.default.createElement(o.default.Item,null,"\u8bc4\u4ef7"),c.default.createElement(o.default.Item,null,"\u8bc4\u4ef7"),c.default.createElement(o.default.Item,null,"\u8bc4\u4ef7"),c.default.createElement(o.default.Item,null,"\u8bc4\u4ef7"),c.default.createElement(o.default.Item,null,"\u8bc4\u4ef7"),c.default.createElement(o.default.Item,null,"\u8bc4\u4ef7"))),c.default.createElement("div",{className:E.default.overview},c.default.createElement(o.default,null,c.default.createElement(o.default.Item,{multipleLine:!0},c.default.createElement("div",null,"\u5546\u5bb6\u4fe1\u606f"),c.default.createElement("div",{className:E.default.subInfo},a.name)),c.default.createElement(o.default.Item,{extra:(a.flavors||[]).map(e=>e.name).join("\u3001")},"\u54c1\u7c7b"),c.default.createElement(o.default.Item,{extra:a.phone},"\u5546\u5bb6\u7535\u8bdd"),c.default.createElement(o.default.Item,{extra:a.address},"\u5730\u5740"),c.default.createElement(o.default.Item,{extra:(a.opening_hours||[]).join("\u3001")},"\u8425\u4e1a\u65f6\u95f4")),c.default.createElement(u.default,null),c.default.createElement(o.default,null,c.default.createElement(o.default.Item,{arrow:"horizontal"},"\u8425\u4e1a\u8d44\u8d28")))),0===t&&c.default.createElement("div",{className:E.default.footer},c.default.createElement(d.default,null,"\xa520\u8d77\u9001")))}}t.default=_},eQPK:function(e,t,a){e.exports={discover:"discover___2tfNI",info:"info___AmrpZ",logo:"logo___2cvdo",title:"title___2frtT",premium:"premium___2jERe",menu:"menu___3nkyk",menuItem:"menuItem___1O643",list:"list___2OO8a",foodType:"foodType___2FaH2",desc:"desc___2MXEf",food:"food___3Gnyu",image:"image___22mb5",subInfo:"subInfo___18O0b",footer:"footer___1SULP",overview:"overview___184xy",shop:"shop___1gt0b"}}}]);